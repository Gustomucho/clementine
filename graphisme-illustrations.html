  // ======================
  // Lightbox (zoom images)
  // - Ouvre au clic sur [data-lightbox]
  // - Ferme: ESC / clic dehors / bouton
  // - Navigue: ← →
  // ======================
  (function initLightbox(){
    const lightbox = document.getElementById("lightbox");
    const imgEl = document.getElementById("lightboxImg");
    const titleEl = document.getElementById("lightboxTitle");
    if (!lightbox || !imgEl) return;

    const items = Array.from(document.querySelectorAll("[data-lightbox]"));
    if (!items.length) return;

    let index = 0;

    function openAt(i){
      index = (i + items.length) % items.length;
      const node = items[index];
      const src = node.getAttribute("data-lightbox");
      const caption = node.getAttribute("data-caption") || "Aperçu";
      const alt = node.querySelector("img")?.getAttribute("alt") || caption;

      imgEl.src = src;
      imgEl.alt = alt;
      if (titleEl) titleEl.textContent = caption;

      lightbox.classList.add("is-open");
      lightbox.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function close(){
      lightbox.classList.remove("is-open");
      lightbox.setAttribute("aria-hidden", "true");
      imgEl.src = "";
      document.body.style.overflow = "";
    }

    function next(){ openAt(index + 1); }
    function prev(){ openAt(index - 1); }

    // Click / keyboard on thumbnails
    items.forEach((node, i) => {
      node.addEventListener("click", () => openAt(i));
      node.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openAt(i);
        }
      });
    });

    // Buttons
    lightbox.querySelector("[data-lightbox-close]")?.addEventListener("click", close);
    lightbox.querySelector("[data-lightbox-next]")?.addEventListener("click", next);
    lightbox.querySelector("[data-lightbox-prev]")?.addEventListener("click", prev);

    // Click outside content closes
    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) close();
    });

    // Global keys
    document.addEventListener("keydown", (e) => {
      if (!lightbox.classList.contains("is-open")) return;
      if (e.key === "Escape") close();
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
    });
  })();
